@model ChampionshipMvc3.Models.DataContext.Playfield
@using ChampionshipMvc3.Models.Repositories

<script src="@Url.Content("~/Scripts/CustomScripts/tableFillerScheduleLayout.js")" type="text/javascript"></script>
    
<table id="structureTable">
    <tr>
        @{
            ReservationRepository reservationRepo = new ReservationRepository();
            var allReservations = reservationRepo.GetPlayfieldReservations(Model.PLayfieldID);
          
        }

        @for (int dayIndex = 0; dayIndex < 7; dayIndex++)
        {
           
            DateTime displayDate = DateTime.Now.AddDays(dayIndex);
            <td>
                <label>@displayDate.ToShortDateString()</label>
                <label>@displayDate.DayOfWeek</label>
                <table>
                    
                    @for (int hourIndex = Model.PlayfieldOwner.StartHour; hourIndex < Model.PlayfieldOwner.EndHour; hourIndex++)
                    {
                        bool isReserved = false;
                        <tr>
                            <td>
                                @{
                                    var compareDate = DateTime.Parse(displayDate.ToShortDateString() + " " + hourIndex.ToString() + ":00");
                                    if(allReservations.Any(r => r.ReservationDate.Equals(compareDate)))
                                    {
                                        isReserved = true; 
                                    }
                                }
                                <label>@isReserved</label>
                            </td>
                        </tr>
                    }
                </table>
            </td>
        }
    </tr>
</table>

